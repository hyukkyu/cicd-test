# =====================================
# Application Identity & Server Basics
# =====================================
spring.application.name=community_java
server.port=${SERVER_PORT:8080}
server.forward-headers-strategy=framework
server.servlet.session.cookie.same-site=NONE
server.servlet.session.cookie.secure=true
server.servlet.session.timeout=30m
spring.session.store-type=jdbc
spring.session.jdbc.initialize-schema=always

# =====================================
# Database (overrides via env/Secrets)
# =====================================
spring.datasource.url=${spring.datasource.url:}
spring.datasource.username=${spring.datasource.username:}
spring.datasource.password=${spring.datasource.password:}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

spring.jpa.hibernate.ddl-auto=${DB_DDL_AUTO:update}
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=${HIBERNATE_DIALECT:org.hibernate.dialect.MySQL8Dialect}
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.time_zone=Asia/Seoul
spring.jpa.defer-datasource-initialization=true

# =====================================
# Secrets Manager (fail fast on missing secrets)
# =====================================
app.aws.secrets.required=cms-community/db,cms-community/s3,cms-community/cognito
app.aws.secrets.fail-fast=true

# =====================================
# Multipart Upload Limits
# =====================================
spring.servlet.multipart.max-file-size=100MB
spring.servlet.multipart.max-request-size=100MB

# =====================================
# Tomcat concurrency
# =====================================
server.tomcat.accept-count=${TOMCAT_ACCEPT_COUNT:200}
server.tomcat.max-connections=${TOMCAT_MAX_CONNECTIONS:8192}
server.tomcat.threads.max=${TOMCAT_MAX_THREADS:400}

# =====================================
# AWS & Terraform Alignment (ap-south-1)
# =====================================
cloud.aws.region.static=${AWS_REGION:ap-northeast-1}
cloud.aws.stack.auto=false

cloud.aws.s3.bucket=${S3_BUCKET_NAME:}
cloud.aws.cloudfront.domain=${CLOUDFRONT_DOMAIN:}
cloud.aws.sqs.queue-name=${SQS_QUEUE_NAME:rekognition-results-queue}
cloud.aws.sns.topic.arn=${SNS_TOPIC_ARN:}
cloud.aws.iam.role.arn=${IAM_ROLE_ARN:}
app.video.sqs-enabled=${VIDEO_SQS_ENABLED:false}

app.aws.access-key=${APP_AWS_ACCESS_KEY:}
app.aws.secret-key=${APP_AWS_SECRET_KEY:}
app.aws.region=${cloud.aws.region.static}
app.aws.comprehend-region=${APP_AWS_COMPREHEND_REGION:ap-northeast-1}
app.aws.translate-region=${APP_AWS_TRANSLATE_REGION:ap-northeast-1}
app.aws.rekognition-region=${APP_AWS_REKOGNITION_REGION:ap-northeast-1}
app.aws.bucket-name=${S3_BUCKET_NAME:}
app.aws.sns-topic-arn=${SNS_TOPIC_ARN:}
app.aws.cloudfront-domain=${CLOUDFRONT_DOMAIN:}
app.moderation.callback-token=${MODERATION_CALLBACK_TOKEN:}
app.frontend.allowed-origins=${FRONTEND_ALLOWED_ORIGINS:https://user.cms-community.com,https://admin.cms-community.com,https://d3ip0fzux1meud.cloudfront.net,https://d2gq4jrp38imi.cloudfront.net}
app.moderation.text-block-threshold=${TEXT_BLOCK_THRESHOLD:0.7}
app.moderation.media-block-threshold=${MEDIA_BLOCK_THRESHOLD:0.7}
app.moderation.review-threshold=${REVIEW_THRESHOLD:0.5}
app.moderation.pipeline-topic-arn=${MODERATION_SNS_TOPIC_ARN:${app.aws.sns-topic-arn}}
app.moderation.pipeline-queue-url=${MODERATION_SQS_QUEUE_URL:}
app.moderation.admin-email=${MODERATION_ADMIN_EMAIL:}

app.monitoring.grafana-url=${GRAFANA_URL:http://cms-community-mon-nlb-ffbff355b06c0244.elb.ap-northeast-1.amazonaws.com:3000}
app.monitoring.ec2-health-enabled=${EC2_HEALTH_ENABLED:true}
app.monitoring.ec2-instance-id=${MONITORING_EC2_INSTANCE_ID:}
app.monitoring.ec2-instance-tag-key=${MONITORING_EC2_INSTANCE_TAG_KEY:}
app.monitoring.ec2-instance-tag-value=${MONITORING_EC2_INSTANCE_TAG_VALUE:}
prometheus.server.url=${PROMETHEUS_SERVER_URL:http://172.31.21.10:9090}

# =====================================
# Cognito (user flows)
# =====================================
com.example.authapp.cognito.access-key=${COGNITO_ACCESS_KEY:}
com.example.authapp.cognito.secret-key=${COGNITO_SECRET_KEY:}
com.example.authapp.cognito.userPoolId=${COGNITO_USER_POOL_ID:}
com.example.authapp.cognito.clientId=${COGNITO_CLIENT_ID:}

# =====================================
# Logging
# =====================================
logging.level.org.springframework.security=INFO
logging.level.org.springframework.web=INFO
logging.level.com.example.authapp=DEBUG

management.endpoints.web.exposure.include=health,info,prometheus
management.endpoint.prometheus.enabled=true
management.server.port=${MANAGEMENT_PORT:${server.port}}
